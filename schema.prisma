datasource db {
  provider = "postgresql"
  // Wasp requires that the url is set to the DATABASE_URL environment variable.
  url      = env("DATABASE_URL")
}

// Wasp requires the `prisma-client-js` generator to be present.
generator client {
  provider = "prisma-client-js"
}

model User {
  id              Int            @id @default(autoincrement())
  email           String         @unique
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  isEmailVerified Boolean        @default(false)
  username        String?        @unique
  firstName       String?
  lastName        String?
  conversations   Conversation[]
  nodes           Node[]
}

model Conversation {
  id               String    @id @default(uuid())
  user             User      @relation(fields: [userId], references: [id])
  userId           Int
  title            String?
  lastActiveNodeId String?   @db.VarChar(255)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  nodes            Node[]
}

model Node {
  id                String       @id @default(uuid())
  conversationId    String
  userId            Int
  parentId          String?
  userMessage       String       @db.Text
  assistantMessage  String       @db.Text
  summary           String       @db.Text
  x                 Int          @default(0)
  y                 Int          @default(0)
  width             Int          @default(250)
  expanded          Boolean      @default(false)
  isPinned          Boolean      @default(false)
  path              Json
  visible           Boolean      @default(true)
  createdAt         DateTime     @default(now())
  
  conversation      Conversation @relation(fields: [conversationId], references: [id])
  user              User         @relation(fields: [userId], references: [id])
  parent            Node?        @relation("NodeToNode", fields: [parentId], references: [id])
  children          Node[]       @relation("NodeToNode")
  
  @@index([conversationId])
  @@index([userId])
  @@index([parentId])
}

